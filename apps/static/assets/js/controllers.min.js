/*! technology-radar 27-05-2017 */
"use strict";var cuControllers=angular.module("cuControllers",[]);cuControllers.filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():""}}),cuControllers.filter("encodeURIComponent",function(){return function(a){return a.replace(/ /g,"-")}}),cuControllers.controller("menuBar",["$scope","$location","$rootScope",function(a,b,c){a.isActive=function(a){var c=-1!=a.search("service")&&-1!=b.path().search("service");return a===b.path()||0===b.path().indexOf(a)||c},c.$on("$routeChangeStart",function(b,c,d){a.title="",c.params.group&&(a.title=" for "+c.params.group)})}]),cuControllers.controller("GroupController",["$scope","$log","$sce","TechnologyRadar","$modal","$location",function(a,b,c,d,e,f){var g=function(){a.groupList=[],a.loading=!0,a.getGroupList(),a.admin=!1,1==f.path().indexOf("admin")&&(a.admin=!0)};a.getGroupList=function(){d.getGroupList().then(function(c){a.loading=!1,a.groupList=c.group_list,b.info("GROUP LIST -- ",a.groupList)},function(d){a.fail=!0,a.loading=!1,a.class_name="red";var e=d.data&&d.data.message?d.data.message:techConstants.errorMsg;b.error("Reason for Failure ---",e),a.message=c.trustAsHtml("Reason for Failure ---"+e)},function(a){b.info("Update  ---",a)})},a.addGroup=function(){e.open({templateUrl:"/static/partials/groupsCreate.html",controller:"GroupCreateController",size:"sm",backdrop:"static",resolve:{delete_group:function(){return!1},group:function(){return""}}})},a.deleteGroup=function(a){e.open({templateUrl:"/static/partials/groupsCreate.html",controller:"GroupCreateController",size:"sm",backdrop:"static",resolve:{delete_group:function(){return!0},group:function(){return a}}})},a.$on("getGroupList",function(b,c){a.getGroupList()}),g()}]),cuControllers.controller("GroupCreateController",["$scope","$modalInstance","$log","$rootScope","TechnologyRadar","$sce","delete_group","group",function(a,b,c,d,e,f,g,h){a.fail=!1,a.deleteGroup=g,a.group=h,a.close=function(){b.dismiss("cancel")},a.ok=function(){a.groups=a.groups.replace(/ /g,"-").split(","),c.debug(a.groups),a.loading=!0,e.addGroup(a.groups).then(function(a){d.$broadcast("getGroupList"),b.dismiss("cancel")},function(b){a.fail=!0,a.loading=!1,a.class="red";var d=b.data&&b.data.message?b.data.message:techConstants.errorMsg;c.error("Reason for Failure ---",d),a.message=f.trustAsHtml("Reason for Failure ---"+d)},function(a){c.info("Update  ---",a)})},a.delete=function(){c.debug(a.group),a.loading=!0,e.deleteGroup(a.group).then(function(a){d.$broadcast("getGroupList"),b.dismiss("cancel")},function(b){a.fail=!0,a.loading=!1,a.class="red";var d=b.data&&b.data.message?b.data.message:techConstants.errorMsg;c.error("Reason for Failure ---",d),a.message=f.trustAsHtml("Reason for Failure ---"+d)},function(a){c.info("Update  ---",a)})}}]),cuControllers.controller("TechController",["$scope","$sce","$log","TechnologyRadar","$rootScope","$modal","$location","$routeParams",function(a,b,c,d,e,f,g,h){var i=function(){var b=/^[a-zA-Z0-9-_]+$/;-1!=h.group.search(b)?(a.techList=[],a.groupList=[],a.groupSelected=h.group,a.loading=!0,a.fail=!1,a.update=!1,g.search().update&&(a.update=!0),a.getTechList(a.groupSelected)):g.url("/"),$(window).scroll(function(){$(this).scrollTop()>50?$(".scrolltop:hidden").stop(!0,!0).fadeIn():$(".scrolltop").stop(!0,!0).fadeOut()})};a.scrollTop=function(){$("html, body").animate({scrollTop:$(".navbar").offset().top-1e4},1e3)};var j=function(a){var b=_.pluck(a,"categories");return _.pluck(b[0],"label")},k=function(a){var b=_.pluck(a,"categories");return _.flatten(_.pluck(_.flatten(b),"technologies"))},l=function(a){return _.pluck(a,"label")};a.setActive=function(b){_.each(a.techList,function(a){a.active=!1}),b.active=!0},a.getTechList=function(f){a.gotData=!1,d.getTechnologyList(f).then(function(b){0!=b.tech_list.length?(a.loading=!1,a.gotData=!0,a.techList=b.tech_list,c.info("Tech List MAIN -- ",a.techList),a.radarData=b.tech_list,a.categories=j(a.techList),a.technologies=k(a.techList),a.statuses=l(a.techList),a.activeCategory={},a.activeStatus={},a.activeTechLabel="",a.currentCategory="",a.currentTech="",a.tech_data={},a.viewTech=!1,c.info("Tech List -- ",a.techList),c.info("Tech Categories -- ",a.categories),c.info("Tech technologies -- ",a.technologies),c.info("Tech Statues -- ",a.statuses),a.setActive(a.techList[0]),e.$broadcast("redraw")):g.url("/")},function(d){a.loading=!1,a.fail=!0,a.class_name="red";var e=d.data&&d.data.message?d.data.message:techConstants.errorMsg;c.error("Reason for Failure ---",e),a.message=b.trustAsHtml("Reason for Failure ---"+e)},function(a){c.info("Update  ---",a)})},a.removeTech=function(b,c,d){var e={status:c,category:b,tech:d};f.open({templateUrl:"/static/partials/techDelete.html",controller:"TechDeleteController",size:"sm",backdrop:"static",resolve:{tech_data:function(){return e},categoryList:function(){return a.categories},statusList:function(){return a.statuses},group:function(){return a.groupSelected}}})},a.infoTech=function(c,d,e){a.currentStatus=c,a.currentTech=d.label,a.description=b.trustAsHtml(d.description),e&&(a.viewTech=!0)},a.closeInfo=function(){a.currentCategory="",a.currentTech="",a.activeCategory="",a.activeStatus="",a.tech_data={},a.viewTech=!1,a.showInfo=!1,d3.selectAll("text").style("opacity",1).style("font-weight","normal").style("cursor","default")},a.editTech=function(b,c,d){var e={status:c.label,category:b.label,tech:d};a.showInfoModal(e,!1)},a.addTech=function(b,c){var d={status:c,category:b};a.showInfoModal(d,!1)},a.collapse=function(a){$(event.target.parentNode.nextElementSibling.nextElementSibling).is(":visible")?$(event.target.parentNode.nextElementSibling.nextElementSibling).fadeOut():$(event.target.parentNode.nextElementSibling.nextElementSibling).fadeIn()},a.$on("setActiveTab",function(b,c){a.setActive(c)}),a.$on("showInfo",function(b,c,d){a.infoTech(c,d)}),a.$on("setVariables",function(b,c){a.setVariables(Object.keys(c)[0],c[Object.keys(c)[0]])}),a.$on("getTechList",function(b,c){a.getTechList(a.groupSelected)}),a.setVariables=function(b,c){a[b]=c},a.displayLabels=function(){a.activeCategory=_.findWhere(_.flatten(_.pluck(a.techList,"categories")),{active:!0}),a.activeStatus=_.find(a.techList,function(b){return _.indexOf(b.categories,a.activeCategory)>=0})},a.hideLables=function(){_.each(_.flatten(_.pluck(a.techList,"categories")),function(a,b){a.active&&(a.active=!1)})},a.showInfoModal=function(b,c){var d=!c;f.open({templateUrl:"/static/partials/techInfo.html",controller:"TechInfoController",size:"lg",backdrop:"static",resolve:{tech_data:function(){return b},editInfo:function(){return d},categoryList:function(){return a.categories},statusList:function(){return a.statuses},group:function(){return a.groupSelected}}})},i()}]),cuControllers.controller("TechInfoController",["$scope","$modalInstance","tech_data","$log","editInfo","$rootScope","categoryList","statusList","group","TechnologyRadar","$sce",function(a,b,c,d,e,f,g,h,i,j,k){a.fail=!1,a.tech_data=c,a.editInfo=e,a.categoryList=g,a.statusList=h,a.tech={category:c.category,status:c.status,tech:c.tech,group:i},c.tech&&(a.description=k.trustAsHtml(c.tech.description)),a.close=function(){b.dismiss("cancel"),f.$broadcast("setVariables",{viewTech:!1}),d3.selectAll("text").style("opacity",1).style("font-weight","normal").style("cursor","default"),$(".bold").removeClass("bold")},a.ok=function(){d.debug(a.tech),a.tech.tech||(a.tech.tech={},a.tech.tech.description=""),d.debug("AFTER --",a.tech),a.loading=!0,j.editTech(a.tech).then(function(a){f.$broadcast("getTechList"),b.dismiss("cancel")},function(b){a.fail=!0,a.loading=!1,a.class="red";var c=b.data&&b.data.message?b.data.message:techConstants.errorMsg;d.error("Reason for Failure ---",c),a.message=k.trustAsHtml("Reason for Failure ---"+c)},function(a){d.info("Update  ---",a)})}}]),cuControllers.controller("TechDeleteController",["$scope","$modalInstance","tech_data","$log","$rootScope","categoryList","statusList","group","TechnologyRadar","$sce",function(a,b,c,d,e,f,g,h,i,j){a.tech_data=c,a.categoryList=f,a.statusList=g,a.tech={category:c.category,status:c.status,tech:c.tech,group:h},a.close=function(){b.dismiss("cancel")},a.ok=function(){d.debug(a.tech),i.deleteTech(a.tech).then(function(a){e.$broadcast("getTechList"),b.dismiss("cancel")},function(b){a.fail=!0,a.class="red";var c=b.data&&b.data.message?b.data.message:techConstants.errorMsg;d.error("Reason for Failure ---",c),a.message=j.trustAsHtml("Reason for Failure ---"+c)},function(a){d.info("Update  ---",a)}),b.dismiss("cancel")}}]);